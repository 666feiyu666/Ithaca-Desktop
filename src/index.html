<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>伊萨卡手记 (Ithaca Journal)</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/room.css"> 
    <link rel="stylesheet" href="css/city.css">
    <link rel="stylesheet" href="css/shop.css">
</head>
<body>

<div id="scene-room" class="room-container">
        
    <div class="iso-room">
    <img src="assets/images/roombg.png" class="room-background" alt="Room Background">
    
    </div>

    </div>

        <div class="room-hud">
            <span>📅 Day <span id="day-display-room">1</span></span>
            <span style="margin-left: 10px;">💧 <span id="ink-display-room">0</span> ml</span>
        </div>

        <div id="decoration-hud" style="display: none;">
            <div class="deco-hint">🏗️ 装修模式：拖拽家具调整位置，拖回下方回收</div>
            
            <div class="inventory-bar-container">
                <div id="inventory-bar" class="inventory-list">
                    </div>
            </div>
            
            <button id="btn-close-deco" class="action-btn" style="position:fixed; bottom: 20px; right: 20px; z-index: 200;">
                完成装修
            </button>
        </div>

        <div class="top-right-toolbar">
            <button id="btn-icon-shop" class="icon-btn" title="家具商店 (开发中)">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </button>

            <button id="btn-icon-map" class="icon-btn" title="城市地图">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                    <line x1="8" y1="2" x2="8" y2="18"></line>
                    <line x1="16" y1="6" x2="16" y2="22"></line>
                </svg>
            </button>

            <button id="btn-icon-journal" class="icon-btn" title="回顾手记">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
            </button>

            <button id="btn-icon-theme" class="icon-btn" title="切换时段">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <button id="btn-icon-deco" class="icon-btn" title="装修房间">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v18H3zM9 9h6v6H9z"/>
                </svg>
            </button>

            <button id="btn-icon-reset" class="icon-btn" title="【开发用】重置所有数据" style="border-color: #ffcccc; color: #d32f2f;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
    </button>
        </div>
    </div>

    <div id="scene-map" class="map-container" style="display: none;">
        
        <img src="assets/images/street.png" class="map-bg" alt="City Street">

        <div id="hotspot-luckin" class="map-node-hotspot" 
            style="
                top: 50%; 
                left: 12%; 
                width: 18%; 
                height: 25%;
            "
            title="Luckin Coffee (休息一下)">
        </div>

        <div id="hotspot-home-pin" class="map-node-hotspot" 
            style="
                top: 15%; 
                left: 36%; 
                width: 22%; 
                height: 65%;
            "
            title="回家 (点击返回房间)">
        </div>

    </div>
    
    <div id="modal-desk" class="modal-overlay full-screen-modal">
        <div class="modal-content desk-layout">
            <header>
                <h2>📝 写作台</h2>
                <div>
                    <button id="btn-open-workbench" class="action-btn">🔨 进入装订模式</button>
                    <button class="btn-close-modal" onclick="closeModal('modal-desk')">❌ 返回房间</button>
                </div>
            </header>

            <div class="layout">
                <div class="sidebar">
                    <div class="sidebar-header">
                        <h4>往日文档</h4>
                        <button id="btn-new-entry" title="新建日记">+</button>
                    </div>
                    <div id="journal-list"></div>
                </div>

                <div class="main-editor">
                    <textarea id="editor-area" placeholder="在这里记下你的思绪..."></textarea>
                    <div class="editor-footer">
                        <span id="save-status">(输入自动保存)</span>
                        <div style="display: flex; gap: 10px;">
                            <button id="btn-delete-entry" style="background: #d32f2f; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
                                🗑️ 删除
                            </button>
                            <button id="btn-confirm-entry">✅ 确认记录 (+10 墨水)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="modal-bookshelf-ui" class="modal-overlay full-screen-modal">
        <div class="modal-content bookshelf-layout">
            <header>
                <h2>📚书架</h2>
                <button class="btn-close-modal" onclick="closeModal('modal-bookshelf-ui')">❌ 返回房间</button>
            </header>
            
            <section class="bookshelf-section">
                <div id="bookshelf">
                    </div>
            </section>
        </div>
    </div>


    <div id="workbench-modal" class="modal-overlay">
        <div class="modal-content workbench-layout">
            
            <div class="workbench-sidebar">
                <h3>1. 选择素材</h3>
                
                <input type="text" id="workbench-search" placeholder="🔍 搜索关键词或 #标签..." 
                       style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                
                <p class="hint">点击下方片段导入书稿</p>
                
                <div id="workbench-sources" style="flex: 1; overflow-y: auto;"></div>
            </div>

            <div class="workbench-main">
                <h3>2. 编辑书稿 (Manuscript)</h3>

                <input type="text" id="manuscript-title-input" placeholder="请输入书名..." 
                    style="width: 100%; padding: 10px; font-size: 16px; font-weight: bold; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">

                <div class="cover-selection-area">
                    <label style="font-size: 14px; color: #666; display: block; margin-bottom: 8px;">选择封皮：</label>
                    <div class="cover-options" id="cover-options-container">
                        <img src="assets/images/booksheet1.png" class="cover-option selected" data-cover="booksheet1.png">
                        <img src="assets/images/booksheet2.png" class="cover-option" data-cover="booksheet2.png">
                        <img src="assets/images/booksheet3.png" class="cover-option" data-cover="booksheet3.png">
                    </div>
                </div>

                <textarea id="manuscript-editor" placeholder="在这里拼贴、润色你的书稿..."></textarea>
                
                <div class="modal-actions">
                    <button id="btn-close-workbench" class="btn-cancel">取消</button>
                    <button id="btn-publish" class="btn-primary">📘 出版成书</button>
                </div>
            </div>
        </div>
    </div>

    <div id="reader-modal" class="modal-overlay">
        <div class="modal-content reader-layout">
            <div class="reader-header">
                <span id="reader-date" style="color:#888; font-size:12px;"></span>
                <div>
                    <button id="btn-delete-book" class="action-btn" style="background:none; color:#d32f2f; border:1px solid #d32f2f; padding: 4px 8px; font-size: 12px; margin-right: 5px;">
                        🗑️ 销毁
                </button>
        
                <button id="btn-edit-book" class="action-btn" style="padding: 4px 8px; font-size: 12px; margin-right: 5px;">✏️ 修订</button>
                <button id="btn-close-reader" class="close-btn">×</button>
            </div>
        </div>

            <div id="reader-view-mode">
                <h2 id="reader-title" style="text-align:center; margin-top:0;"></h2>
                <hr style="border:0; border-bottom:1px solid #eee; margin:20px 0;">
                <div id="reader-text" class="paper-text"></div>
            </div>

            <div id="reader-edit-mode" style="display: none; flex-direction: column; gap: 10px;">
                <input type="text" id="reader-title-input" placeholder="书名" 
                       style="font-size: 18px; padding: 5px; text-align: center; font-weight: bold; width: 100%;">
                
                <textarea id="reader-content-input" 
                          style="min-height: 300px; padding: 10px; font-size: 16px; line-height: 1.8; resize: vertical; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                
                <div style="text-align: right; margin-top: 10px;">
                    <button id="btn-cancel-edit" class="btn-cancel">取消</button>
                    <button id="btn-save-book" class="btn-primary">💾 保存修订</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-shop" class="modal-overlay full-screen-modal">
        <div class="modal-content shop-layout">
            <header>
                <h2>🛒 家具商店</h2>
                <div class="shop-balance">
                    当前余额: 💧 <span id="shop-ink-display">0</span>
                </div>
                <button class="btn-close-modal" onclick="document.getElementById('modal-shop').style.display='none'">❌ 关闭</button>
            </header>
            
            <div id="shop-list" class="shop-grid">
                </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
    
    <script>
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }
    </script>
    

</body>
</html>