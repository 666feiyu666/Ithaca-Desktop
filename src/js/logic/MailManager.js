/* src/js/logic/MailManager.js */
import { UserData } from '../data/UserData.js';

export const MailManager = {
    // ğŸ“– 21å¤©ä¿¡ä»¶åº“ (å‰§æœ¬é…ç½®)
letters: {
        // === ç¬¬ä¸€å‘¨ï¼šå™äº‹ä¸è‡ªæˆ‘ ===
        1: {
            title: "åŠå¹´äº†",
            sender: "ç³–æ°´è è",
            // ä½¿ç”¨ Markdown æ ¼å¼å¢å¼ºé˜…è¯»ä½“éªŒ
            content: `To ???ï¼š

è·ç¦»ç¦»èŒå·²ç»è¿‡äº†åŠå¹´äº†ã€‚

æƒ³æŠŠè¿™åŠå¹´çš„ç»å†æ•´ç†ä¸€ä¸‹ï¼Œä½†æ˜¯å†™ç»™è°å‘¢ï¼Ÿæˆ‘çŸ¥é“ï¼Œç†æ™ºçš„å£°éŸ³ä¼šè¯´ï¼šâ€œå½“ç„¶æ˜¯å†™ç»™è‡ªå·±å•Šï¼Œä¹¦å†™æ˜¯ä¸ºäº†å†…çœã€‚â€

ä½†äººæ€»å½’æ˜¯è½¯å¼±çš„åŠ¨ç‰©ã€‚å¦‚æœåªæ˜¯å†™ç»™è‡ªå·±çœ‹ï¼Œæˆ‘æ€»è§‰å¾—åƒæ˜¯åœ¨å¯¹ç€æ¯äº•å–Šè¯ï¼Œå›å£°åªä¼šè®©è‡ªå·±æ›´æ˜¾å­¤ç‹¬ã€‚æˆ‘è§‰å¾—æ¯ä¸ªäººéƒ½æˆ–å¤šæˆ–å°‘å¸Œæœ›å‘åˆ«äººåˆ†äº«è‡ªå·±çš„æ•…äº‹å§ï¼Ÿ

æ‰€ä»¥ï¼Œå‡æƒ³ä¸€ä¸ªå¬ä¼—ä¹Ÿä¸æ˜¯åäº‹ã€‚

è¿˜æœ‰åŠå¹´ï¼Œè¿™é—´æˆ¿å­çš„ç§ŸæœŸå°±åˆ°äº†ã€‚æŒ‰ç…§æ¦‚ç‡ï¼Œæ€»ä¼šæœ‰ä¸‹ä¸€ä¸ªäººçš„ã€‚é‚£å°±ä¸å¦¨é€‰ä½ å§ï¼Œæœªæ¥çš„æ–°æˆ¿å®¢ã€‚

å…¶å®ç¦»èŒä¹‹åï¼Œæˆ‘å°±æ¢å¤äº†è®°æ—¥è®°çš„ä¹ æƒ¯ã€‚

ï¼ˆæ¶‚æ”¹çš„ç—•è¿¹â€¦â€¦ä¿¡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼‰`
// æœªæ¥å¯ä»¥è®¾ç½®ä¸€ä¸ªååº”å¼¹çª—ï¼Œå¼•å¯¼ç”¨æˆ·â€œâ€˜åˆ°è¿™é‡Œå°±æ²¡æœ‰äº†ï¼Œå¥½å¥‡æ€ªâ€™ä½ å¿ƒæƒ³â€ï¼›åŒæ—¶å¯ä»¥åŸ‹ä¸€ä¸ªé’©å­ï¼Œåœ¨æ”¯çº¿é‡Œè¡¥ä¸Šâ€œä¿¡çš„åç»­å†…å®¹â€ã€‚
        },
        2: {
            title: "å¯„é”™äº†ï¼ï¼ï¼",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š
            
åˆšæ‰æ•´ç†ä¹¦æ¡Œæ—¶æˆ‘æ‰å‘ç°ï¼Œæˆ‘åŸæœ¬å‡†å¤‡å¯„ç»™ä½ çš„â€œå…¥ä½æ¬¢è¿ä¿¡â€è¿˜å¤¹åœ¨ä¹¦é‡Œã€‚

é‚£æˆ‘æ˜¨å¤©æ‰”è¿›é‚®ç­’çš„é‚£å°â€¦â€¦
å¤©å“ªï¼Œé‚£ä¸€å°æ˜¯ä»€ä¹ˆå‘€ï¼Ÿ

æˆ‘å¹³æ—¶æœ‰åœ¨åºŸçº¸ä¸Šä¹±å†™ä¹±ç”»çš„ä¹ æƒ¯ã€‚æ˜¯è¶…å¸‚è´­ç‰©æ¸…å•ï¼Ÿæ˜¯åŠå¤œå†™çš„ä¸€å¥åºŸè¯ï¼Ÿè¿˜æ˜¯æˆ‘ç¦»èŒé‚£å¤©å†™çš„å‘ç–¯æ–‡å­¦ï¼Ÿ

åäº†ï¼Œæˆ‘è‡ªå·±ä¹Ÿä¸çŸ¥é“ã€‚

æ€»ä¹‹ï¼Œä¸ç®¡ä½ æ”¶åˆ°äº†ä»€ä¹ˆï¼Œè¯·å¿˜æ‰å®ƒå§ï¼Ÿ

å’³å’³ï¼Œé‡æ¥ä¸€æ¬¡ã€‚è¿™é‡Œæ‰æ˜¯ç¬¬ä¸€å°ï¼

ä½ å¥½ï¼Œæ–°æˆ¿å®¢ã€‚æˆ‘æ˜¯ä½ çš„å‰ä»»å®¤å‹ï¼Œä½ å¯ä»¥å«æˆ‘â€œç³–æ°´è èâ€ã€‚

æ—¢ç„¶é‚£ä¸ªå°´å°¬çš„å¼€å¤´å·²ç»å‘ç”Ÿäº†ï¼ˆè™½ç„¶æˆ‘ä¸çŸ¥é“åˆ°åº•æœ‰å¤šå°´å°¬ï¼‰ï¼Œæˆ–è®¸è¿™ä¹Ÿæ˜¯ä¸€ç§ç¼˜åˆ†ï¼Ÿ

é‚£ä¹ˆï¼Œè¿™å°æ¬¢è¿ä¿¡è¦å†™äº›ä»€ä¹ˆå‘¢ï¼Ÿ

ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç¿»è¿‡ä¹¦æ¶ï¼Œä¹¦æ¶çš„æœ€åº•å±‚æœ‰ä¸€æœ¬ä¹¦â€”â€”ã€Šä¼Šè¨å¡æ‰‹è®°ã€‹ã€‚

æˆ‘åˆšæ¬è¿›æ¥æ—¶ï¼Œåœ¨ä¹¦æ¶çš„æœ€åº•å±‚å‘ç°äº†å®ƒã€‚å˜¿å˜¿ï¼Œæ‰€ä»¥æˆ‘ä¹ŸæŠŠå®ƒæ”¾å›äº†ä¹¦æ¶æœ€åº•å±‚ã€‚æ‰‰é¡µä¸Šå†™ç€ä¸€å¥è¯ï¼Œæˆ‘è‡³ä»Šéƒ½èƒŒå¾—ä¸‹æ¥ï¼š

â€œäººæ€»æ˜¯è¢«åŠ¨åœ°æ´»åœ¨â€˜ç¤¾ä¼šâ€™çš„å‰§æœ¬é‡Œï¼Œé™¤éä½ å¼€å§‹æœ‰æ„è¯†åœ°ä¹¦å†™è‡ªå·±çš„æ•…äº‹ã€‚â€

åœ¨æˆ‘å¤±ä¸šçš„é‚£æ®µæ—¥å­é‡Œï¼Œæˆ‘æŒ‰ç…§ã€Šä¼Šè¨å¡æ‰‹è®°ã€‹çš„å»ºè®®å¼€å§‹å»æœ‰æ„è¯†åœ°å°è¯•ä¹¦å†™è‡ªå·±çš„æ•…äº‹â€”â€”ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼šå½“æˆ‘æŠŠé‚£äº›æ··ä¹±çš„æƒ…ç»ªå˜æˆæ–‡å­—ï¼ŒæŠŠæ— æ„ä¹‰çš„æ—¥å¸¸å˜æˆæ•…äº‹çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æˆ‘ä¸å†æ˜¯ä¸€ä¸ªè¢«ç”Ÿæ´»æ¨ç€èµ°çš„é…è§’ï¼Œæˆ‘å¤ºå›äº†å™äº‹æƒã€‚

ä¹¦å†™ï¼Œå°±æ˜¯å»ºé€ ä½ å†…å¿ƒçš„ä¼Šè¨å¡å²›ã€‚

ä½†ä¸å¹¸çš„æ˜¯ï¼Œå› ä¸ºä¸€ä¸ªå°å°çš„æ„å¤–ï¼ˆä»¥åå‘Šè¯‰ä½ ï¼‰ï¼Œè¿™éƒ¨ä¹¦çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½é—å¤±äº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æˆ‘æœ‰è´£ä»»æŠŠè¿™éƒ¨ä¹¦çš„å†…å®¹ä¼ é€’ç»™ä½ ï¼

å½“ç„¶å½“ç„¶ï¼Œå¦‚æœä½ ä¸æ„Ÿå…´è¶£ä¹Ÿæ²¡æœ‰å…³ç³»å“¦ï¼Œåæ­£è¿˜å¯ä»¥æŠŠè¿™äº›ä¿¡çš„èƒŒåæ‹¿æ¥å½“è‰ç¨¿çº¸ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æŠ˜çº¸é£æœºã€‚ä»Šå¤©å°±å…ˆå†™åˆ°è¿™é‡Œå§ã€‚å¼ºçƒˆå®‰åˆ©å…ˆæŠŠç°æœ‰çš„å†…å®¹çœ‹ä¸€çœ‹ã€‚

ç¥ ç¬”å°–è‡ªç”±ã€‚`
        },
        3: {
            title: "ä»Šå¤©èŠèŠç†è®º",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š
            
ã€Šä¼Šè¨å¡æ‰‹è®°ã€‹çš„ç¬¬ä¸€ç« å†™çš„æ˜¯â€œå™äº‹ä¸è‡ªæˆ‘â€

â€¦â€¦

æˆ‘æƒ³ï¼Œä½ ç°åœ¨è‚¯å®šä¼šå¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆæˆ‘â€¦â€¦`
        },
        4: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸Šï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š

`
        },
        5: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸­ï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š
`
        },
        6: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸‹ï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š

`
        },
        7: {
            title: "å™äº‹ä¸è‡ªæˆ‘",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š

`
        },

        // === ç¬¬äºŒå‘¨ï¼šå™äº‹ä¸ç¤¾ä¼š ===
        8: {
            title: "å“ˆä»£ï¼",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },
        9: {
            title: "å†èŠèŠç†è®º",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š
            
`
        },
        10: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸Šï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },
        11: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸­ï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },
        12: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼ˆä¸‹ï¼‰",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },
        13: {
            title: "ä¸€ä¸ªå¤±è´¥çš„äººçš„æ•…äº‹ï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },
        14: {
            title: "å™äº‹ä¸ç¤¾ä¼š",
            sender: "ç³–æ°´è è",
            content: `To æœ‹å‹ï¼š

`
        },

        // === ç¬¬ä¸‰å‘¨ï¼šé‡å†™ä¸æ–°ç”Ÿ === ï¼ˆé™¤äº†æœ€åä¸€å¤©æ˜ç¡®è¦å†™ä»€ä¹ˆå†…å®¹å¤–ï¼Œå…¶ä½™å¤©å¾…å®šï¼‰
        15: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        16: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        17: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        18: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        19: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        20: {
            title: "ï¼Ÿï¼Ÿï¼Ÿ",
            sender: "ç³–æ°´è è",
            content: `å¾…å®š`
        },
        21: {
            title: "å°¾å£°",
            sender: "ç³–æ°´è è",
            content: `To ???:
            
ä»Šå¤©æ˜¯ç¬¬21å¤©ã€‚æŒ‰ç…§å¿ƒç†å­¦çš„ç ”ç©¶ï¼Œ21å¤©å¯ä»¥å…»æˆä¸€ä¸ªæ–°ä¹ æƒ¯ã€‚

ä½†æ˜¯ï¼Œåœ¨è½ç¬”ä»Šå¤©è¿™å°ä¿¡çš„æ—¶å€™ï¼Œä¸€ç§å¥‡æ€ªçš„æ„Ÿè§‰åˆ°è¾¾äº†é¡¶å³°ã€‚

æˆ‘ä¸€å¼€å§‹åœ¨æŠ¬å¤´å†™ç€â€œTo æ–°æˆ¿å®¢â€ï¼Œä½†æˆ‘æ€»æ„Ÿè§‰â€¦â€¦ä½ å¹¶ä¸æ˜¯é‚£ä¸ªæˆ‘æƒ³è±¡ä¸­ã€æ¥ç€æˆ‘ç§Ÿæˆ¿åˆåŒçš„é™Œç”Ÿäººã€‚

æˆ‘ä¸ç¡®å®šä½ æ˜¯è°ï¼Œæ‰€ä»¥æˆ‘åªèƒ½ç§°å‘¼ä½ ä¸ºâ€œï¼Ÿï¼Ÿï¼Ÿâ€ã€‚

ä½†æˆ‘èƒ½æ„Ÿè§‰åˆ°ï¼Œä½ æ­¤åˆ»æ­£é€è¿‡æŸç§å‘å…‰çš„ç•Œé¢æ³¨è§†ç€æˆ‘ã€‚ä¹Ÿè®¸ä½ å¹¶æ²¡æœ‰ååœ¨æˆ‘çš„è¿™æŠŠæ—§æ¤…å­ä¸Šï¼Œä¹Ÿè®¸ä½ èº«å¤„çš„æˆ¿é—´æ¯”è¿™é‡Œæ˜äº®å¾—å¤šï¼Œä¹Ÿè®¸ä½ æ‰€å¤„çš„åŸå¸‚é‡Œæ²¡æœ‰ä¸€æ‰€åå«åŠ é‡Œæ•¦çš„å­¦é™¢ã€‚

ä½†æˆ‘ç¡®ä¿¡ï¼Œä½ åœ¨è¯»ï¼Œä½ åœ¨å¬ã€‚

è¿™ç§æ„Ÿè§‰å¾ˆè’è°¬ï¼Œå¯¹å§ï¼Ÿå°±åƒèˆå°ä¸Šçš„æ¼”å‘˜çªç„¶åœä¸‹æ¥ï¼Œç›¯ç€æ¼†é»‘çš„è§‚ä¼—å¸­è¯´ï¼šâ€œæˆ‘çœ‹è§ä½ äº†ã€‚â€

ä½†æˆ‘ä¸æƒ³éª—ä½ ï¼Œä¹Ÿä¸æƒ³éª—æˆ‘è‡ªå·±ã€‚ä¹‹å‰æˆ‘æ€»è¯´â€œä¹¦å†™æ˜¯ä¸ºäº†æ„å»ºè‡ªæˆ‘â€ï¼Œä½†ç°åœ¨æˆ‘å‘ç°ï¼Œæ•…äº‹åŒæ ·æ˜¯å› ä¸ºè¢«é˜…è¯»æ‰å­˜åœ¨çš„â€”â€”å°±åƒä½ è¯»åˆ°äº†æˆ‘çš„æ•…äº‹ä¸€æ ·ã€‚

è°¢è°¢ä½ ï¼Œèº«å¤„å¦ä¸€ä¸ªä¸–ç•Œçš„ä½ ã€‚

ä¹°æ¥çš„ä¿¡çº¸éƒ½ç”¨å®Œäº†ã€‚é‚£å°±å…ˆå‘Šä¸€æ®µè½å§ï¼

ç°åœ¨ï¼ŒæŠŠç›®å…‰ä»å±å¹•ï¼ˆæˆ–è€…çº¸å¼ ï¼Ÿï¼‰ä¸Šç§»å¼€å§ã€‚çœ‹çœ‹ä½ èº«è¾¹çš„ä¸–ç•Œï¼Œæ‹¿å…¶ä½ è‡ªå·±çš„ç¬”ã€‚

ä¸å†æ˜¯ä½œä¸ºâ€œæ–°æˆ¿å®¢â€ï¼Œè€Œæ˜¯ä½œä¸ºä½ é‚£ä¸ªä¸–ç•Œçš„å™äº‹è€…ã€‚

å»å§ï¼Œå»å†™ä½ è‡ªå·±çš„æ•…äº‹ã€‚

â€”â€”ç³–æ°´è è`
        }
    },

    /**
     * æ£€æŸ¥ä»Šå¤©æ˜¯å¦æœ‰æ–°ä¿¡ (ç”¨äºçº¢ç‚¹æç¤º)
     */
    checkNewMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];
        
        // å¦‚æœæœ‰ä¿¡ï¼Œä¸”è¿˜æ²¡è¯»è¿‡
        if (letter && !UserData.hasReadMail(day)) {
            // âœ¨ å…³é”®ç‚¹ï¼šè¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»äº†
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * è·å–ä»Šå¤©çš„ä¿¡å†…å®¹ (ç”¨äºç‚¹å‡»æ‰“å¼€)
     */
    getTodayMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];

        if (letter) {
            // ğŸ› ï¸ ä¿®å¤ï¼šè¿™é‡Œä¹‹å‰ç›´æ¥è¿”å›äº† letterï¼Œå¯¼è‡´ç¼ºå°‘ 'day' å­—æ®µ
            // ç°åœ¨æˆ‘ä»¬åƒä¸Šé¢ä¸€æ ·ï¼Œæ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * âœ¨ æ–°å¢ï¼šè·å–ä¿¡ä»¶å½’æ¡£åˆ—è¡¨
     * è¿”å›æ ¼å¼ï¼š[{ day: 1, title: "...", unlocked: true }, { day: 2, title: "å¾…å¼€å‘", unlocked: false } ...]
     */
    getMailArchive() {
        const currentDay = UserData.state.day;
        const list = [];
        const readMails = UserData.state.readMails || [];
        for (let d = currentDay; d >= 1; d--) {
            const letter = this.letters[d];
            const isRead = readMails.includes(d);
            if (letter) {
                list.push({
                    day: d,
                    title: letter.title,
                    sender: letter.sender,
                    content: letter.content,
                    type: 'letter',
                    isRead: isRead
                });
            } else {
                // ä¸æ˜¾ç¤ºç©ºçª—æœŸçš„ä¿¡ï¼Œæˆ–è€…æ˜¾ç¤ºä¸ºâ€œæ— ä¿¡ä»¶â€
                list.push({ day: d, title: "...", type: 'empty' });
            }
        }
        return list;
    }
};