/* src/js/logic/MailManager.js */
import { UserData } from '../data/UserData.js';

export const MailManager = {
    // ğŸ“– 21å¤©ä¿¡ä»¶åº“ (å‰§æœ¬é…ç½®)
letters: {
        1: {
            title: "åŠå¹´äº†",
            sender: "ç³–æ°´è è",
            // ä½¿ç”¨ Markdown æ ¼å¼å¢å¼ºé˜…è¯»ä½“éªŒ
            content: `To ???ï¼š

è·ç¦»ç¦»èŒå·²ç»è¿‡äº†åŠå¹´äº†ã€‚

æƒ³æŠŠè¿™åŠå¹´çš„ç»å†æ•´ç†ä¸€ä¸‹ï¼Œä½†æ˜¯å†™ç»™è°å‘¢ï¼Ÿæˆ‘çŸ¥é“ï¼Œç†æ™ºçš„å£°éŸ³ä¼šè¯´ï¼šâ€œå½“ç„¶æ˜¯å†™ç»™è‡ªå·±å•Šï¼Œä¹¦å†™æ˜¯ä¸ºäº†å†…çœã€‚â€

ä½†äººæ€»å½’æ˜¯è½¯å¼±çš„åŠ¨ç‰©ã€‚å¦‚æœåªæ˜¯å†™ç»™è‡ªå·±çœ‹ï¼Œæˆ‘æ€»è§‰å¾—åƒæ˜¯åœ¨å¯¹ç€æ¯äº•å–Šè¯ï¼Œå›å£°åªä¼šè®©è‡ªå·±æ›´æ˜¾å­¤ç‹¬ã€‚æˆ‘è§‰å¾—æ¯ä¸ªäººéƒ½æˆ–å¤šæˆ–å°‘å¸Œæœ›å‘åˆ«äººåˆ†äº«è‡ªå·±çš„æ•…äº‹å§ï¼Ÿ

æ‰€ä»¥ï¼Œå‡æƒ³ä¸€ä¸ªå¬ä¼—ä¹Ÿä¸æ˜¯åäº‹ã€‚

è¿˜æœ‰åŠå¹´ï¼Œè¿™é—´æˆ¿å­çš„ç§ŸæœŸå°±åˆ°äº†ã€‚æŒ‰ç…§æ¦‚ç‡ï¼Œæ€»ä¼šæœ‰ä¸‹ä¸€ä¸ªäººçš„ã€‚é‚£å°±ä¸å¦¨é€‰ä½ å§ï¼Œæœªæ¥çš„æ–°æˆ¿å®¢ã€‚

å…¶å®ç¦»èŒä¹‹åï¼Œæˆ‘å°±æ¢å¤äº†è®°æ—¥è®°çš„ä¹ æƒ¯ã€‚

ï¼ˆæ¶‚æ”¹çš„ç—•è¿¹â€¦â€¦ä¿¡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼‰`
// æœªæ¥å¯ä»¥è®¾ç½®ä¸€ä¸ªååº”å¼¹çª—ï¼Œå¼•å¯¼ç”¨æˆ·â€œâ€˜åˆ°è¿™é‡Œå°±æ²¡æœ‰äº†ï¼Œå¥½å¥‡æ€ªâ€™ä½ å¿ƒæƒ³â€ï¼›åŒæ—¶å¯ä»¥åŸ‹ä¸€ä¸ªé’©å­ï¼Œåœ¨æ”¯çº¿é‡Œè¡¥ä¸Šâ€œä¿¡çš„åç»­å†…å®¹â€ã€‚
        },
        2: {
            title: "å¯„é”™äº†ï¼ï¼ï¼",
            sender: "ç³–æ°´è è",
            content: `To æ–°æˆ¿å®¢ï¼š
            
åˆšæ‰æ•´ç†ä¹¦æ¡Œæ—¶æˆ‘æ‰å‘ç°ï¼Œæˆ‘åŸæœ¬å‡†å¤‡å¯„ç»™ä½ çš„â€œå…¥ä½æ¬¢è¿ä¿¡â€è¿˜å¤¹åœ¨ä¹¦é‡Œã€‚

é‚£æˆ‘æ˜¨å¤©æ‰”è¿›é‚®ç­’çš„é‚£å°â€¦â€¦
å¤©å“ªï¼Œé‚£ä¸€å°æ˜¯ä»€ä¹ˆå‘€ï¼Ÿ

æˆ‘å¹³æ—¶æœ‰åœ¨åºŸçº¸ä¸Šä¹±å†™ä¹±ç”»çš„ä¹ æƒ¯ã€‚æ˜¯è¶…å¸‚è´­ç‰©æ¸…å•ï¼Ÿæ˜¯åŠå¤œå†™çš„ä¸€å¥åºŸè¯ï¼Ÿè¿˜æ˜¯æˆ‘ç¦»èŒé‚£å¤©å†™çš„å‘ç–¯æ–‡å­¦ï¼Ÿ

åäº†ï¼Œæˆ‘è‡ªå·±ä¹Ÿä¸çŸ¥é“ã€‚

æ€»ä¹‹ï¼Œä¸ç®¡ä½ æ”¶åˆ°äº†ä»€ä¹ˆï¼Œè¯·å¿˜æ‰å®ƒå§ï¼Ÿ

å’³å’³ï¼Œé‡æ¥ä¸€æ¬¡ã€‚è¿™é‡Œæ‰æ˜¯ç¬¬ä¸€å°ï¼

ä½ å¥½ï¼Œæ–°æˆ¿å®¢ã€‚æˆ‘æ˜¯ä½ çš„å‰ä»»å®¤å‹ï¼Œä½ å¯ä»¥å«æˆ‘â€œç³–æ°´è èâ€ã€‚

æ—¢ç„¶é‚£ä¸ªå°´å°¬çš„å¼€å¤´å·²ç»å‘ç”Ÿäº†ï¼ˆè™½ç„¶æˆ‘ä¸çŸ¥é“åˆ°åº•æœ‰å¤šå°´å°¬ï¼‰ï¼Œæˆ–è®¸è¿™ä¹Ÿæ˜¯ä¸€ç§ç¼˜åˆ†ï¼Ÿ

é‚£ä¹ˆï¼Œè¿™å°æ¬¢è¿ä¿¡è¦å†™äº›ä»€ä¹ˆå‘¢ï¼Ÿ

ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç¿»è¿‡ä¹¦æ¶ï¼Œä¹¦æ¶çš„æœ€åº•å±‚æœ‰ä¸€æœ¬ä¹¦â€”â€”ã€Šä¼Šè¨å¡æ‰‹è®°ã€‹ã€‚

æˆ‘åˆšæ¬è¿›æ¥æ—¶ï¼Œåœ¨ä¹¦æ¶çš„æœ€åº•å±‚å‘ç°äº†å®ƒã€‚å˜¿å˜¿ï¼Œæ‰€ä»¥æˆ‘ä¹ŸæŠŠå®ƒæ”¾å›äº†ä¹¦æ¶æœ€åº•å±‚ã€‚æ‰‰é¡µä¸Šå†™ç€ä¸€å¥è¯ï¼Œæˆ‘è‡³ä»Šéƒ½èƒŒå¾—ä¸‹æ¥ï¼š

â€œäººæ€»æ˜¯è¢«åŠ¨åœ°æ´»åœ¨â€˜ç¤¾ä¼šâ€™çš„å‰§æœ¬é‡Œï¼Œé™¤éä½ å¼€å§‹æœ‰æ„è¯†åœ°ä¹¦å†™è‡ªå·±çš„æ•…äº‹ã€‚â€

åœ¨æˆ‘å¤±ä¸šçš„é‚£æ®µæ—¥å­é‡Œï¼Œæˆ‘æŒ‰ç…§ã€Šä¼Šè¨å¡æ‰‹è®°ã€‹çš„å»ºè®®å¼€å§‹å»æœ‰æ„è¯†åœ°å°è¯•ä¹¦å†™è‡ªå·±çš„æ•…äº‹â€”â€”ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼šå½“æˆ‘æŠŠé‚£äº›æ··ä¹±çš„æƒ…ç»ªå˜æˆæ–‡å­—ï¼ŒæŠŠæ— æ„ä¹‰çš„æ—¥å¸¸å˜æˆæ•…äº‹çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æˆ‘ä¸å†æ˜¯ä¸€ä¸ªè¢«ç”Ÿæ´»æ¨ç€èµ°çš„é…è§’ï¼Œæˆ‘å¤ºå›äº†å™äº‹æƒã€‚

ä¹¦å†™ï¼Œå°±æ˜¯å»ºé€ ä½ å†…å¿ƒçš„ä¼Šè¨å¡å²›ã€‚

ä½†ä¸å¹¸çš„æ˜¯ï¼Œå› ä¸ºä¸€ä¸ªå°å°çš„æ„å¤–ï¼ˆä»¥åå‘Šè¯‰ä½ ï¼‰ï¼Œè¿™éƒ¨ä¹¦çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½é—å¤±äº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æˆ‘æœ‰è´£ä»»æŠŠè¿™éƒ¨ä¹¦çš„å†…å®¹ä¼ é€’ç»™ä½ ï¼

å½“ç„¶å½“ç„¶ï¼Œå¦‚æœä½ ä¸æ„Ÿå…´è¶£ä¹Ÿæ²¡æœ‰å…³ç³»å“¦ï¼Œåæ­£è¿˜å¯ä»¥æŠŠè¿™äº›ä¿¡çš„èƒŒåæ‹¿æ¥å½“è‰ç¨¿çº¸ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æŠ˜çº¸é£æœºã€‚ä»Šå¤©å°±å…ˆå†™åˆ°è¿™é‡Œå§ã€‚å¼ºçƒˆå®‰åˆ©å…ˆæŠŠç°æœ‰çš„å†…å®¹çœ‹ä¸€çœ‹ã€‚

ç¥ ç¬”å°–è‡ªç”±ã€‚`
        },
        7: {
            title: "ğŸª‘ ä¹ æƒ¯",
            sender: "ç³–æ°´è è",
            content: "å·²ç»æ˜¯ç¬¬7å¤©äº†ã€‚ä½ å¼€å§‹ä¹ æƒ¯è¿™é‡Œçš„æŸç§å£°éŸ³äº†å—ï¼Ÿ\n\næ¯”å¦‚å†°ç®±å‹ç¼©æœºå¯åŠ¨çš„å—¡å—¡å£°ï¼Œæˆ–è€…éš”å£é‚»å±…èµ°è·¯çš„å£°éŸ³ã€‚\n\nåœ¨è¿™ä¸ªåŸå¸‚ï¼Œæˆ‘ä»¬åœ¨å·¨å¤§çš„å™ªéŸ³ä¸­å¯»æ‰¾å±äºè‡ªå·±çš„é¢‘ç‡ã€‚"
        },
        // ... ä¸­é—´å¯ä»¥æ ¹æ®éœ€è¦å¡«å……æ›´å¤šå¤©æ•° ...
        21: {
            title: "ğŸ’» æºä»£ç ",
            sender: "å¼€å‘è€…",
            content: "å—¨ï¼Œæœ‹å‹ã€‚\n\nä»Šå¤©æ˜¯ç¬¬21å¤©ã€‚æŒ‰ç…§å¿ƒç†å­¦çš„è¯´æ³•ï¼Œä½ å·²ç»å…»æˆäº†ä¸€ä¸ªä¹ æƒ¯ã€‚\n\nå…¶å®ï¼Œæ²¡æœ‰ä»€ä¹ˆâ€œç³–æ°´è èâ€ã€‚\næˆ–è€…è¯´ï¼Œ**æˆ‘å°±æ˜¯é‚£ä¸ªå†™ä¸‹è¿™äº›ä»£ç çš„äºº**ã€‚\n\næˆ‘åˆ›é€ è¿™ä¸ªæˆ¿é—´ï¼Œæ˜¯å› ä¸ºæˆ‘æ›¾åœ¨è¿™ä¸ªåŸå¸‚çš„æ´ªæµé‡Œè¿·å¤±è¿‡ã€‚æˆ‘è¯•å›¾ç”¨ä»£ç æ„å»ºä¸€ä¸ªé¿éš¾æ‰€ï¼Œä½†æˆ‘å‘ç°ï¼ŒçœŸæ­£çš„åº‡æŠ¤æ‰€ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯ä½ é€šè¿‡ä¹¦å†™å»ºç«‹èµ·æ¥çš„å†…å¿ƒç§©åºã€‚\n\nä»æ˜å¤©èµ·ï¼Œä¸ä¼šå†æœ‰ä¿¡äº†ã€‚\n\nå› ä¸ºè¿™ä¸ªæˆ¿é—´çš„æ•…äº‹ï¼Œè¯¥ç”±ä½ æ¥ç‹¬å®¶ä¸»ç¬”äº†ã€‚\n\nç¥ä½ åœ¨ä¼Šè¨å¡ï¼Œæ‰¾åˆ°å›å®¶çš„è·¯ã€‚"
        }
    },

    /**
     * æ£€æŸ¥ä»Šå¤©æ˜¯å¦æœ‰æ–°ä¿¡ (ç”¨äºçº¢ç‚¹æç¤º)
     */
    checkNewMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];
        
        // å¦‚æœæœ‰ä¿¡ï¼Œä¸”è¿˜æ²¡è¯»è¿‡
        if (letter && !UserData.hasReadMail(day)) {
            // âœ¨ å…³é”®ç‚¹ï¼šè¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»äº†
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * è·å–ä»Šå¤©çš„ä¿¡å†…å®¹ (ç”¨äºç‚¹å‡»æ‰“å¼€)
     */
    getTodayMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];

        if (letter) {
            // ğŸ› ï¸ ä¿®å¤ï¼šè¿™é‡Œä¹‹å‰ç›´æ¥è¿”å›äº† letterï¼Œå¯¼è‡´ç¼ºå°‘ 'day' å­—æ®µ
            // ç°åœ¨æˆ‘ä»¬åƒä¸Šé¢ä¸€æ ·ï¼Œæ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * âœ¨ æ–°å¢ï¼šè·å–ä¿¡ä»¶å½’æ¡£åˆ—è¡¨
     * è¿”å›æ ¼å¼ï¼š[{ day: 1, title: "...", unlocked: true }, { day: 2, title: "å¾…å¼€å‘", unlocked: false } ...]
     */
    getMailArchive() {
        const currentDay = UserData.state.day;
        const list = [];
        const readMails = UserData.state.readMails || [];

        // å€’åºéå†ï¼šä»ä»Šå¤©å¾€å‰æ¨ (Day N -> Day 1)ï¼Œè¿™æ ·æœ€æ–°çš„åœ¨æœ€ä¸Šé¢
        for (let d = currentDay; d >= 1; d--) {
            const letter = this.letters[d];
            const isRead = readMails.includes(d);
            
            if (letter) {
                list.push({
                    day: d,
                    title: letter.title,
                    sender: letter.sender,
                    content: letter.content,
                    type: 'letter',
                    isRead: isRead
                });
            } else {
                // ç©ºçª—æœŸ
                list.push({
                    day: d,
                    title: "ï¼ˆå¾…å¼€å‘...ï¼‰", // è¿™é‡Œæ˜¾ç¤ºå¾…å¼€å‘
                    type: 'empty'
                });
            }
        }
        return list;
    }
};