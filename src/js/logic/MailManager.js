/* src/js/logic/MailManager.js */
import { UserData } from '../data/UserData.js';

export const MailManager = {
    // ğŸ“– 21å¤©ä¿¡ä»¶åº“ (å‰§æœ¬é…ç½®)
    letters: {
        1: {
            title: "ğŸ‘‹ è‡´æ–°æˆ¿å®¢",
            sender: "ç³–æ°´è è",
            content: "ä½ å¥½ã€‚\n\nè¿™é—´æˆ¿é—´ç©ºç½®äº†å¾ˆä¹…ï¼Œå¾ˆé«˜å…´ç»ˆäºæœ‰äººæ¬è¿›æ¥äº†ã€‚\n\næˆ‘æ˜¯è¿™é‡Œçš„å‰ä»»æˆ¿å®¢ã€‚æˆ‘åœ¨ä¸€äº›å®¶å…·çš„ç¼éš™é‡Œç•™ä¸‹äº†ä¸€äº›è¿‡å»çš„ç¢ç‰‡ï¼Œå¦‚æœä½ åœ¨æ‰“æ‰«ï¼ˆæˆ–è€…è£…ä¿®ï¼‰çš„æ—¶å€™å‘ç°äº†å®ƒä»¬ï¼Œè¯·ä¸è¦ä»‹æ„ã€‚\n\nå¸Œæœ›è¿™ä¸ªåªæœ‰20å¹³ç±³çš„åœ°æ–¹ï¼Œèƒ½å®¹çº³ä½ æ‰€æœ‰çš„æ€ç»ªã€‚"
        },
        3: {
            title: "ğŸŒ§ï¸ å…³äºä¸‹é›¨å¤©",
            sender: "ç³–æ°´è è",
            content: "ä»Šå¤©ä»çª—æˆ·çœ‹å‡ºå»ï¼ŒåŸå¸‚æ˜¯ä¸æ˜¯ç°è’™è’™çš„ï¼Ÿ\n\næˆ‘ä»¥å‰æœ€è®¨åŒä¸‹é›¨å¤©ï¼Œå› ä¸ºåœ°é“ä¼šå¾ˆæŒ¤ã€‚ä½†åæ¥æˆ‘å‘ç°ï¼Œé›¨å¤©æ˜¯è¿™ä¸ªåŸå¸‚å”¯ä¸€å…è®¸æˆ‘ä»¬â€œä¸å¿«ä¹â€çš„æ—¶å€™ã€‚\n\nå¦‚æœä»Šå¤©å¿ƒæƒ…ä¸å¥½ï¼Œä¹Ÿæ²¡å…³ç³»ã€‚"
        },
        7: {
            title: "ğŸª‘ ä¹ æƒ¯",
            sender: "ç³–æ°´è è",
            content: "å·²ç»æ˜¯ç¬¬7å¤©äº†ã€‚ä½ å¼€å§‹ä¹ æƒ¯è¿™é‡Œçš„æŸç§å£°éŸ³äº†å—ï¼Ÿ\n\næ¯”å¦‚å†°ç®±å‹ç¼©æœºå¯åŠ¨çš„å—¡å—¡å£°ï¼Œæˆ–è€…éš”å£é‚»å±…èµ°è·¯çš„å£°éŸ³ã€‚\n\nåœ¨è¿™ä¸ªåŸå¸‚ï¼Œæˆ‘ä»¬åœ¨å·¨å¤§çš„å™ªéŸ³ä¸­å¯»æ‰¾å±äºè‡ªå·±çš„é¢‘ç‡ã€‚"
        },
        // ... ä¸­é—´å¯ä»¥æ ¹æ®éœ€è¦å¡«å……æ›´å¤šå¤©æ•° ...
        21: {
            title: "ğŸ’» æºä»£ç ",
            sender: "å¼€å‘è€…",
            content: "å—¨ï¼Œæœ‹å‹ã€‚\n\nä»Šå¤©æ˜¯ç¬¬21å¤©ã€‚æŒ‰ç…§å¿ƒç†å­¦çš„è¯´æ³•ï¼Œä½ å·²ç»å…»æˆäº†ä¸€ä¸ªä¹ æƒ¯ã€‚\n\nå…¶å®ï¼Œæ²¡æœ‰ä»€ä¹ˆâ€œç³–æ°´è èâ€ã€‚\næˆ–è€…è¯´ï¼Œ**æˆ‘å°±æ˜¯é‚£ä¸ªå†™ä¸‹è¿™äº›ä»£ç çš„äºº**ã€‚\n\næˆ‘åˆ›é€ è¿™ä¸ªæˆ¿é—´ï¼Œæ˜¯å› ä¸ºæˆ‘æ›¾åœ¨è¿™ä¸ªåŸå¸‚çš„æ´ªæµé‡Œè¿·å¤±è¿‡ã€‚æˆ‘è¯•å›¾ç”¨ä»£ç æ„å»ºä¸€ä¸ªé¿éš¾æ‰€ï¼Œä½†æˆ‘å‘ç°ï¼ŒçœŸæ­£çš„åº‡æŠ¤æ‰€ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯ä½ é€šè¿‡ä¹¦å†™å»ºç«‹èµ·æ¥çš„å†…å¿ƒç§©åºã€‚\n\nä»æ˜å¤©èµ·ï¼Œä¸ä¼šå†æœ‰ä¿¡äº†ã€‚\n\nå› ä¸ºè¿™ä¸ªæˆ¿é—´çš„æ•…äº‹ï¼Œè¯¥ç”±ä½ æ¥ç‹¬å®¶ä¸»ç¬”äº†ã€‚\n\nç¥ä½ åœ¨ä¼Šè¨å¡ï¼Œæ‰¾åˆ°å›å®¶çš„è·¯ã€‚"
        }
    },

    /**
     * æ£€æŸ¥ä»Šå¤©æ˜¯å¦æœ‰æ–°ä¿¡ (ç”¨äºçº¢ç‚¹æç¤º)
     */
    checkNewMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];
        
        // å¦‚æœæœ‰ä¿¡ï¼Œä¸”è¿˜æ²¡è¯»è¿‡
        if (letter && !UserData.hasReadMail(day)) {
            // âœ¨ å…³é”®ç‚¹ï¼šè¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»äº†
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * è·å–ä»Šå¤©çš„ä¿¡å†…å®¹ (ç”¨äºç‚¹å‡»æ‰“å¼€)
     */
    getTodayMail() {
        const day = UserData.state.day;
        const letter = this.letters[day];

        if (letter) {
            // ğŸ› ï¸ ä¿®å¤ï¼šè¿™é‡Œä¹‹å‰ç›´æ¥è¿”å›äº† letterï¼Œå¯¼è‡´ç¼ºå°‘ 'day' å­—æ®µ
            // ç°åœ¨æˆ‘ä»¬åƒä¸Šé¢ä¸€æ ·ï¼Œæ‰‹åŠ¨æŠŠ day æ‹¼è¿›å»
            return { day: day, ...letter };
        }
        return null;
    },

    /**
     * âœ¨ æ–°å¢ï¼šè·å–ä¿¡ä»¶å½’æ¡£åˆ—è¡¨
     * è¿”å›æ ¼å¼ï¼š[{ day: 1, title: "...", unlocked: true }, { day: 2, title: "å¾…å¼€å‘", unlocked: false } ...]
     */
    getMailArchive() {
        const currentDay = UserData.state.day;
        const list = [];
        const readMails = UserData.state.readMails || [];

        // å€’åºéå†ï¼šä»ä»Šå¤©å¾€å‰æ¨ (Day N -> Day 1)ï¼Œè¿™æ ·æœ€æ–°çš„åœ¨æœ€ä¸Šé¢
        for (let d = currentDay; d >= 1; d--) {
            const letter = this.letters[d];
            const isRead = readMails.includes(d);
            
            if (letter) {
                list.push({
                    day: d,
                    title: letter.title,
                    sender: letter.sender,
                    content: letter.content,
                    type: 'letter',
                    isRead: isRead
                });
            } else {
                // ç©ºçª—æœŸ
                list.push({
                    day: d,
                    title: "ï¼ˆå¾…å¼€å‘...ï¼‰", // è¿™é‡Œæ˜¾ç¤ºå¾…å¼€å‘
                    type: 'empty'
                });
            }
        }
        return list;
    }
};